extends layout         
block variables
    - var doctor_name = doctor_name
block content          
        
    div.w-screen.shadow-lg.inline.flex
        p.font-bold.text-2xl.mx-4.py-4.text-gray-400 Patients | 
        p.font-bold.text-3xl.py-4.text-black #{patientname}
        p(id='patientemail') #{patientemail}
        div.inline.flex.ml-auto.justify-center.items-center.mx-4 
            p.text-black Last connected devices
            div.inline.flex.justify-center.items-center.border.border-solid.border-blue-400.rounded-lg.mx-6.h-12
                div.inline.flex.justify-center.items-center.mx-4 
                    img(src='monitor icon.png').h-6                     
                    div.h-3.w-3.rounded-full.bg-red-400.justify-center.items-center(style={'margin-left': '-28px', 'margin-top': '-24px'})
                    p.text-xs.mx-6 08/10/22
                div.inline.flex.justify-center.items-center.mx-4 
                    img(src='smartphone icon.svg').h-6 
                    div.h-3.w-3.rounded-full.bg-green-400.justify-center.items-center(style={'margin-left': '-28px', 'margin-top': '-24px'})
                    p.text-xs.mx-6 1 min ago
                div.inline.flex.justify-center.items-center.mx-4 
                    img(src='scales icon.svg').h-6
                    div.h-3.w-3.rounded-full.bg-green-400.justify-center.items-center(style={'margin-left': '-28px', 'margin-top': '-24px'})
                    p.text-xs.mx-6 Yesterday
                div.inline.flex.justify-center.items-center.mx-4 
                    img(src='smartwatch icon.svg').h-6
                    div.h-3.w-3.rounded-full.bg-green-400.justify-center.items-center(style={'margin-left': '-24px', 'margin-top': '-24px'})
                    p.text-xs.mx-2 1 min ago

    div.w-screen.inline.flex.bg-gray-100
        div(class='w-96').border-solid.border-gray-400.rounded-lg.bg-blue-100.m-4
            div.justify-center.items-center.flex.m-6
                img.rounded-full.border.border-gray-400.border-2.w-24.h-24(src='user gray icon.svg')
            div.justify-center.items-center.flex.inline.m-4
                p.text-2xl.font-bold.justify-center.items-center.flex.ml-auto #{patientname}
                img.w-4.h-4.ml-auto.flex.justify-center.items-center(src='pencil gray icon.svg')
            hr.m-4.h-px.border-gray-400.border-1
            table.w-full 
                tr.text-sm 
                    td
                        p.mx-6.mr-auto.flex.font-bold Age 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex 42   
                tr.text-sm 
                    td
                        p.mx-6.mr-auto.flex.font-bold Gender 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex Male   
                tr.text-sm 
                    td
                        p.mx-6.mr-auto.flex.font-bold Occupation 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex Engineer    
                tr.text-sm 
                    td
                        p.mx-6.mr-auto.flex.font-bold Email 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex #{patientemail}    
                tr.text-sm 
                    td
                        p.mx-6.mr-auto.flex.font-bold Home 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex 0367258885 
                tr.text-sm 
                    td
                        p.mx-6.mr-auto.flex.font-bold Mobile 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex 0582654890            
            hr.m-4.h-px.border-gray-400.border-1
            div.justify-center.items-center.flex.inline.m-4
                p.text-2xl.font-bold.justify-center.items-center.flex.ml-auto Medications
                img.w-4.h-4.ml-auto.flex(src='pencil gray icon.svg')

            table.w-full 
                tr.text-sm 
                    td
                        img.mx-6.w-4.h-4.flex(src='medicine icon.svg') 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex Valium 50MG   
                tr.text-sm 
                    td
                        img.mx-6.w-4.h-4.flex(src='medicine icon.svg') 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex Abacavir Sulfate (Ziagen) 100MG   
                tr.text-sm 
                    td
                        img.mx-6.w-4.h-4.flex(src='medicine icon.svg')  
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex Factor IX Complex (Konyne)    
                tr.text-sm 
                    td
                        img.mx-6.w-4.h-4.flex(src='medicine icon.svg') 
                    td.m-1.ml-auto.flex 
                        p.mx-6.ml-auto.flex Uceris (Budesonide Tablets)         
            hr.m-4.h-px.border-gray-400.border-1
            div(id='datepicker').justify-center.items-center.flex.m-4

        div(class='w-1/2').m-4
            div
                div.inline.flex.m-4
                    button.mx-1.rounded-lg.bg-blue-400.text-white.w-36.h-10.shadow-2xl Indicatores
                    button.mx-1.rounded-lg.bg-white.text-gray-500.w-36.h-10.border-2.border-gray-500 Medications
                    button.mx-1.rounded-lg.bg-white.text-gray-500.w-36.h-10.border-2.border-gray-500 Documents
                    button.mx-1.rounded-lg.bg-white.text-gray-500.w-36.h-10.border-2.border-gray-500 Journal
                div.inline.flex.p-4.m-4
                    p.text-2xl.font-bold Indicatores
                    div.inline.flex.ml-auto.mx-4.justify-center.items-center   
                        img(src='bar graph icon.svg' id='toggleGraphBar').h-6.mx-5
                        img(src='menu green icon.svg' id='toggleGraphMenu').h-6.mx-5
                        img(src='pencil gray icon.svg').h-6.mx-5

            table(id='tableBar').px-4.mx-4.w-full.border-separate        
                each val in [1, 2, 3, 4, 5]
                    tr
                        td.rounded-lg.bg-white.border-4.border-gray-100
                            div.inline.flex
                                div.mx-4
                                    p.mx-6.ml-auto.flex.text-2xl.font-bold Stress  
                                    p.mx-6.ml-auto.flex 08/11/2023 - 8:45AM 
                                div.ml-auto.justify-center.items-center.mx-4     
                                    p.text-4xl.font-bold 39
                        td.rounded-lg.bg-white.border-4.border-gray-100
                            div.inline.flex
                                div.mx-4
                                    p.mx-6.ml-auto.flex.text-2xl.font-bold Body Fat  
                                    p.mx-6.ml-auto.flex 08/11/2023 - 8:45AM 
                                div.ml-auto.justify-center.items-center.mx-4     
                                    p.text-4xl.font-bold 39
                    tr
                        td.rounded-lg.bg-white.border-4.border-gray-100
                            div.inline.flex
                                div.mx-4
                                    p.mx-6.ml-auto.flex.text-2xl.font-bold PM  
                                    p.mx-6.ml-auto.flex 08/11/2023 - 8:45AM 
                                div.ml-auto.justify-center.items-center.mx-4     
                                    p.text-4xl.font-bold 39
                        td.rounded-lg.bg-white.border-4.border-gray-100
                            div.inline.flex
                                div.mx-4
                                    p.mx-6.ml-auto.flex.text-2xl.font-bold BMI  
                                    p.mx-6.ml-auto.flex 08/11/2023 - 8:45AM 
                                div.ml-auto.justify-center.items-center.mx-4     
                                    p.text-4xl.font-bold 39 

            table(id='tableMenu').px-0.mx-0.w-full.border-separate        
                tr
                    td.rounded-xl.bg-white.border-4.border-gray-100
                        div
                            p.m-3.text-2xl.font-bold.text-black Heart Rate
                            div(id='heartrate').chart-container.h-64  
                                canvas(id='heartratechart')  

                tr
                    td.rounded-xl.bg-white.border-4.border-gray-100
                        div
                            p.m-3.text-2xl.font-bold.text-black Steps
                            div(id='step').chart-container.h-64  
                                canvas(id='stepchart')         

                tr
                    td.rounded-xl.bg-white.border-4.border-gray-100
                        div
                            p.m-3.text-2xl.font-bold.text-black Burned Calories
                            div(id='burnedcalories').chart-container.h-64  
                                canvas(id='burnedcalorieschart')  

                tr
                    td.rounded-xl.bg-white.border-4.border-gray-100
                        div
                            p.m-3.text-2xl.font-bold.text-black Activity Duration
                            div(id='activityduration').chart-container.h-64  
                                canvas(id='activitydurationchart')                                    

               
        div.m-4
            div.inline.flex.mt-4.mx-4
                button.h-14.w-5.bg-gray-300.border-2.border-white.rounded-l-lg.border-r-0(id='chatbutton' onclick='clickChatButton()')
                    img(src='arrow right white icon.svg')
                div.inline.flex.rounded-tr-lg.bg-white.border.border-gray-400.justify-center.items-center(id='chatdivheader')     
                    p.text-xl.font-bold.w-80.mx-2 Chat
                    div.inline.flex.ml-auto
                        img.rounded-full.w-8.border-2.border-gray-300.mx-2.p-1(src='video icon.svg') 
                        div.inline.flex.justify-center.items-center
                            img.rounded-full.w-8.h-8.mx-2.p-1.bg-blue-300.mx-2.p-1(src='chat white icon.svg') 
                            img.w-5.h-5(src='ok icon.svg' style={'margin-left': '-20px', 'margin-top': '-28px'})                                    
                        img.rounded-full.w-8.border-2.border-gray-300.mx-2(src='whatsapp icon.svg' class='px-1') 

            div(style={'height': '80vh'} id='chatdiv').overflow-y-scroll.flex.flex-col.items-center.bg-white.border.border-gray-400.border-t-0.border-b-0.justify-between.ml-9.mr-4.pb-16                   
                p.font-bold.justify-center.flex.pt-4 Yesterday 
                table.w-full.flex.justify-center.items-center
                    tbody.m-2.w-full.justify-center.items-center
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4
                                    div.inline.bg-blue-50.rounded-2xl.justify-start.inline-flex.p-2.text-sm
                                        p.fa.fa-check-double.text-gray-400.text-sm.ml-2  
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem        
                        
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4.ml-auto.justify-end.flex
                                    div.inline.border-blue-200.border.rounded-2xl.inline-flex.p-2.text-sm
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply           
                           
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4
                                    div.inline.bg-blue-50.rounded-2xl.justify-start.inline-flex.p-2.text-sm
                                        p.fa.fa-check-double.text-gray-400.text-sm.ml-2  
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum    
                        
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4
                                    div.inline.bg-blue-50.rounded-2xl.justify-start.inline-flex.p-2.text-sm
                                        p.fa.fa-check-double.text-gray-400.text-sm.ml-2  
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply dummy text of the 

                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4.ml-auto.justify-end.flex
                                    div.inline.border-blue-200.border.rounded-2xl.justify-end.inline-flex.p-2.text-sm
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply                                                           
            
                p.font-bold.justify-center.flex.pt-4 Today 
                table.w-full.flex.justify-center.items-center
                    tbody.m-2.w-full.justify-center.items-center
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4
                                    div.inline.bg-blue-50.rounded-2xl.justify-start.inline-flex.p-2.text-sm
                                        p.fa.fa-check-double.text-gray-400.text-sm.ml-2  
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem        
                        
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4.ml-auto.justify-end.flex
                                    div.inline.border-blue-200.border.rounded-2xl.justify-end.inline-flex.p-2.text-sm
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply           
                           
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4
                                    div.inline.bg-blue-50.rounded-2xl.justify-start.inline-flex.p-2.text-sm
                                        p.fa.fa-check-double.text-gray-400.text-sm.ml-2  
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum    
                        
                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4
                                    div.inline.bg-blue-50.rounded-2xl.justify-start.inline-flex.p-2.text-sm
                                        p.fa.fa-check-double.text-gray-400.text-sm.ml-2  
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply dummy text of the 

                        tr.w-full.flex.justify-center.items-center
                            td.w-full.justify-center.items-center
                                div.w-72.m-4.ml-auto.justify-end.flex
                                    div.inline.border-blue-200.border.rounded-2xl.inline-flex.p-2.text-sm
                                        p.text-gray-400.text-sm.mx-2 14:23
                                        p Lorem Ipsum is simply             

            div.flex.items-center.bg-white.border.border-gray-400.border-t-0.rounded-b-lg.justify-center.ml-9.mr-4(id='chatdivfooter') 
                div.inline.flex.items-center.bg-gray-100.border.rounded-lg.border-gray-400.m-4.w-full 
                    img.h-6.w-6.m-2(src='attachment icon.png')   
                    span(class='input' role='textbox' contenteditable='true').w-full.border-0.block 
                    img.h-6.w-10.m-2.p-2.bg-red-700.ml-auto.rounded-xl(src='send white icon.png')    

    script.
        function clickChatButton()
        {
            $('#chatdivheader').toggle()  
            $('#chatdivfooter').toggle()  
            $('#chatdiv').toggle()           
        }
        
        // Define array for list of disable dates 
        var array = ['2022-09-14', '2022-09-16', '2022-09-19'] 
        const email = $('#patientemail').text()
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']

        function createChart(chartToCreate, values, beginY, endY)
        {
            return new Chart(chartToCreate, {
                type: 'line',
                data: {
                    labels: values.map(item => new Date(item[0]).getDate() + ' ' + monthNames[new Date(item[0]).getMonth()]),
                    datasets: [{
                        data: values.map(item => item[1]),
                        backgroundColor: 'transparent',
                        borderColor: '#00AAF3',
                        pointBackgroundColor: 'gray',
                        pointBorderColor: 'transparent',
                    }],
                    yHighlightRange : {
                        begin: beginY,
                        end: endY
                    },
                },
                options: {
                    maintainAspectRatio: false,                            
                    title: {
                        display: true,
                        text: 'Optimal range',
                        position: 'right',
                    },
                    legend: {
                        display: false,                                                                
                    },
                    elements: {
                        point:{
                            radius: 4,
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: false,
                        },                                                             
                    },
                    scales: {
                        xAxes: [{                                            
                            gridLines: {
                                    display: false,
                            },
                            ticks: { 
                                fontColor: 'gray',
                                fontSize: 16,
                                autoSkip: true,
                                maxRotation: 0,
                                minRotation: 0,
                                maxTicksLimit: 7,                                             
                            },                                                                                      
                        }],
                        yAxes: [{
                            stacked: false,
                            gridLines: {
                                    display: true,
                            },
                            ticks: {
                                fontColor: 'gray',
                                fontSize: 16   
                            }
                        }]
                    }
                }
            }) 
        }  

        $(document).ready(function() {      
            $('#datepicker').datepicker({
                beforeShowDay: function(date){
                    var string = jQuery.datepicker.formatDate('yy-mm-dd', date)
                    return [ array.indexOf(string) == -1 ]
                },
                onSelect: function (dateText, inst) {                    
                    
                }
            })  
            $('#datepicker' ).datepicker('setDate', '09/20/2022')

            $('#toggleGraphMenu').hide()
            $('#tableMenu').hide()

            $('#patientemail').hide()            
            
            var originalLineDraw = Chart.controllers.line.prototype.draw
            // Extend the line chart, in order to override the draw function.
            Chart.helpers.extend(Chart.controllers.line.prototype, {
                draw : function() {
                    var chart = this.chart
                    // Get the object that determines the region to highlight.
                    var yHighlightRange = chart.config.data.yHighlightRange;

                    // If the object exists.
                    if (yHighlightRange !== undefined) {
                        var ctx = chart.chart.ctx

                        var yRangeBegin = yHighlightRange.begin
                        var yRangeEnd = yHighlightRange.end

                        var xaxis = chart.scales['x-axis-0']
                        var yaxis = chart.scales['y-axis-0']

                        var yRangeBeginPixel = yaxis.getPixelForValue(yRangeBegin)
                        var yRangeEndPixel = yaxis.getPixelForValue(yRangeEnd)

                        ctx.save()

                        // The fill style of the rectangle we are about to fill.
                        ctx.fillStyle = 'rgba(225,243,165,0.2)'
                        // Fill the rectangle that represents the highlight region. The parameters are the closest-to-starting-point pixel's x-coordinate,
                        // the closest-to-starting-point pixel's y-coordinate, the width of the rectangle in pixels, and the height of the rectangle in pixels, respectively.
                        ctx.fillRect(xaxis.left, Math.min(yRangeBeginPixel, yRangeEndPixel), xaxis.right - xaxis.left, Math.max(yRangeBeginPixel, yRangeEndPixel) - Math.min(yRangeBeginPixel, yRangeEndPixel));

                        ctx.restore()
                    }

                    // Apply the original draw function for the line chart.
                    originalLineDraw.apply(this, arguments);
                }
            })                   

            $.ajax({
                type: 'POST',
                url: '/getPatientInfo',
                data: { patientemail:  email },
                success: function(data) {
                    var jsonvalues = data.data
                    
                    var heartratevalues = []
                    for (let i = 0; i < jsonvalues.length; i++){
                        if(jsonvalues[i][0] === 'Vitals' && jsonvalues[i][1] === 'Resting Heart Rate')
                            heartratevalues.push([jsonvalues[i][2], jsonvalues[i][3]]) 
                    }
                    heartratevalues = Array.from(new Set(heartratevalues.map(JSON.stringify))).map(JSON.parse)
                    heartratevalues = heartratevalues.sort((a, b) => a[0] - b[0])

                    var ctxheartrate = document.getElementById('heartratechart').getContext('2d')                   
                    var heartratechart = createChart(ctxheartrate, heartratevalues, 60, 90)

                    var stepvalues = []
                    for (let i = 0; i < jsonvalues.length; i++){
                        if(jsonvalues[i][0] === 'Activity' && jsonvalues[i][1] === 'Steps')
                            stepvalues.push([jsonvalues[i][2], jsonvalues[i][3]])  
                    }
                    stepvalues = Array.from(new Set(stepvalues.map(JSON.stringify))).map(JSON.parse)
                    stepvalues = stepvalues.sort((a, b) => a[0] - b[0])

                    var ctxstep = document.getElementById('stepchart').getContext('2d')                   
                    var stepchart = createChart(ctxstep, stepvalues, 5000, 10000)

                    var burnedcaloriesvalues = []
                    for (let i = 0; i < jsonvalues.length; i++){
                        if(jsonvalues[i][0] === 'Activity' && jsonvalues[i][1] === 'Burned Calories')
                    burnedcaloriesvalues.push([jsonvalues[i][2], jsonvalues[i][3]])
                    }
                    burnedcaloriesvalues = Array.from(new Set(burnedcaloriesvalues.map(JSON.stringify))).map(JSON.parse)
                    burnedcaloriesvalues = burnedcaloriesvalues.sort((a, b) => a[0] - b[0])

                    var ctxburnedcalories = document.getElementById('burnedcalorieschart').getContext('2d')                   
                    var burnedcalorieschart = createChart(ctxburnedcalories, burnedcaloriesvalues, 1000, 2000)

                    var activitydurationvalues = []
                    for (let i = 0; i < jsonvalues.length; i++){
                        if(jsonvalues[i][0] === 'Activity' && jsonvalues[i][1] === 'Activity Duration')
                            activitydurationvalues.push([jsonvalues[i][2], jsonvalues[i][3]]) 
                    }
                    activitydurationvalues = Array.from(new Set(activitydurationvalues.map(JSON.stringify))).map(JSON.parse)
                    activitydurationvalues = activitydurationvalues.sort((a, b) => a[0] - b[0])

                    var ctxactivityduration = document.getElementById('activitydurationchart').getContext('2d')                   
                    var activitydurationchart = createChart(ctxactivityduration, activitydurationvalues, 20, 30)
                                          
                },
                failure: function(errMsg) {
                    alert(errMsg)
                }                        
            })
        })  

        $('#toggleGraphBar, #toggleGraphMenu').click(function(){
            $('#toggleGraphBar, #toggleGraphMenu').toggle()
            $('#tableBar, #tableMenu').toggle()
        })

        




        
    
        